---
name: Lint

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  python-lint:
    name: Python Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8 black pylint mypy types-python-dateutil

      - name: Run flake8
        run: |
          flake8 mouse_keepalive/ --max-line-length=120 --extend-ignore=E203,W503

      - name: Run black (check)
        run: |
          black --check --line-length=120 mouse_keepalive/

      - name: Run pylint
        run: |
          pylint mouse_keepalive/ --max-line-length=120 --disable=C0111 || true

      - name: Run mypy (type checking)
        run: |
          mypy mouse_keepalive/ --ignore-missing-imports || true

  shell-lint:
    name: Shell Script Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install ShellCheck
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck

      - name: Run ShellCheck
        run: |
          shellcheck move_mouse.sh || true

  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install markdownlint-cli
        run: |
          npm install -g markdownlint-cli

      - name: Run markdownlint
        run: |
          markdownlint "*.md" --config .markdownlint.json || true

  yaml-lint:
    name: YAML Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install yamllint
        run: |
          pip install yamllint

      - name: Run yamllint
        run: |
          yamllint -c .yamllint.yml .github/workflows/*.yml || true

  batch-lint:
    name: Batch Script Linting
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check batch script syntax
        run: |
          # Basic syntax check for batch files
          echo "Checking batch script syntax..."
          findstr /C:"@echo off" move_mouse.bat >nul || exit 1
          echo "Batch script syntax check passed"

  all-linters:
    name: All Linters Summary
    runs-on: ubuntu-latest
    needs: [python-lint, shell-lint, markdown-lint, yaml-lint, batch-lint]
    if: always()
    steps:
      - name: Linting Results
        run: |
          echo "## Linting Results" >> $GITHUB_STEP_SUMMARY
          echo "- Python: ${{ needs.python-lint.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Shell: ${{ needs.shell-lint.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Markdown: ${{ needs.markdown-lint.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- YAML: ${{ needs.yaml-lint.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Batch: ${{ needs.batch-lint.result }}" >> $GITHUB_STEP_SUMMARY
